{% extends "layout.html" %}

{% block content %}
<main class="container mx-auto px-4 py-2 mt-4 max-w-[1200px]">
    <div class="bg-green-50 text-green-800 py-3 px-6 text-center rounded-md mb-6">
        <h1 class="text-lg uppercase tracking-wide">Parab√©ns! Voc√™ foi aprovada para receber o Implanon gratuitamente</h1>
    </div>
    
    <!-- Ranking Information -->
    <div class="mb-6">
        <div class="text-center mb-4">
            <h2 class="text-lg font-bold text-gray-800 mb-2">üèÜ Lista de Agendamentos Confirmados</h2>
            <p class="text-gray-700 font-medium" id="ranking-info">Voc√™ est√° na <strong>2¬™ posi√ß√£o</strong> para agendamento do Implanon em <span id="user-city-display"></span></p>
        </div>
        
        <!-- Ranking Table -->
        <div class="overflow-x-auto">
            <table class="w-full max-w-5xl mx-auto border border-gray-300 rounded-lg bg-white shadow-lg">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="border border-gray-300 px-1 py-2 text-center font-semibold w-12">Pos.</th>
                        <th class="border border-gray-300 px-6 py-2 text-left font-semibold">Nome da Paciente</th>
                    </tr>
                </thead>
                <tbody id="ranking-table-body">
                    <!-- Rankings will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="mb-6">
        <p class="mb-3 text-base">Informamos que voc√™ foi aprovada com sucesso na avalia√ß√£o de elegibilidade para o Implanon. Sua situa√ß√£o m√©dica e social foi avaliada e aprovada, estando liberada para agendar a consulta gratuita em uma cl√≠nica conveniada.</p>
    </div>


    <!-- Requisitos e Documenta√ß√£o Section -->
    <div class="container px-4 mt-4">
        <div class="flex items-center gap-3 mb-6 bg-red-100 p-4 rounded-[4px]">
            <div class="w-8 h-8 flex items-center justify-center">
                <i class="fas fa-exclamation-triangle text-red-600"></i>
            </div>
            <h1 class="text-[18px] font-bold text-red-600">Para concluir o processo e agendar seu Implanon gratuito verifique os Requisitos abaixo:</h1>
        </div>

        <div class="relative">
            <!-- Vertical bar -->
            <div class="absolute left-4 top-0 bottom-0 w-1 bg-gradient-to-b from-[#21C55D] to-[#21C55D]" style="background-size: 100% 45%;"></div>
            <div class="absolute left-4 top-0 bottom-0 w-1 bg-gray-300" style="top: 45%;"></div>

            <!-- Content -->
            <div class="space-y-4 pl-11">
                <!-- Approved items -->
                <div class="bg-[#21C55D] bg-opacity-20 rounded-[4px] p-4 flex items-center -ml-1" style="margin-right: 20px;">
                    <img src="https://png.pngtree.com/png-vector/20220812/ourmid/pngtree-check-3d-icon-png-image_6108005.png" alt="Check icon" class="w-10 h-10 mr-4 drop-shadow-md absolute -left-1">
                    <span class="text-[16px] text-gray-800 font-medium">Avalia√ß√£o de elegibilidade m√©dica</span>
                </div>

                <div class="bg-[#21C55D] bg-opacity-20 rounded-[4px] p-4 flex items-center -ml-1" style="margin-right: 20px;">
                    <img src="https://png.pngtree.com/png-vector/20220812/ourmid/pngtree-check-3d-icon-png-image_6108005.png" alt="Check icon" class="w-10 h-10 mr-4 drop-shadow-md absolute -left-1">
                    <span class="text-[16px] text-gray-800 font-medium">Aprova√ß√£o para Implanon SUS</span>
                </div>

                <div class="bg-[#21C55D] bg-opacity-20 rounded-[4px] p-4 flex items-center -ml-1" style="margin-right: 20px;">
                    <img src="https://png.pngtree.com/png-vector/20220812/ourmid/pngtree-check-3d-icon-png-image_6108005.png" alt="Check icon" class="w-10 h-10 mr-4 drop-shadow-md absolute -left-1">
                    <span class="text-[16px] text-gray-800 font-medium">Localiza√ß√£o de cl√≠nica conveniada</span>
                </div>

                <!-- Pending item -->
                <div class="bg-red-100 rounded-[4px] p-4">
                    <div class="flex items-center">
                        <img src="https://static.vecteezy.com/system/resources/previews/017/209/854/non_2x/red-wrong-3d-ui-icon-free-png.png" alt="X icon" class="w-12 h-12 mr-4 drop-shadow-md absolute -left-2">
                        <span class="text-[16px] text-gray-800 font-medium">Agendar consulta m√©dica para aplica√ß√£o</span>
                    </div>
                    <button class="bg-red-600 text-white font-bold py-2 px-4 rounded-[4px] mt-3 hover:bg-red-700 transition button-3d text-shadow animate-left-right" onclick="window.location.href='/agendamento'">
                        AGENDAR AGORA
                    </button>
                </div>

                <!-- Upcoming item -->
                <div class="bg-gray-200 rounded-[4px] p-4 flex items-center -ml-1" style="margin-right: 20px;">
                    <img src="https://icones.pro/wp-content/uploads/2021/02/icone-de-tique-ronde-grise.png" alt="Check icon" class="w-7 h-7 mr-4 drop-shadow-md absolute left-0">
                    <span class="text-[16px] text-gray-800 font-medium">Aplica√ß√£o do Implanon</span>
                </div>
                <p class="text-[12px] text-gray-600 mt-1">
                    Para receber o <strong>Implanon gratuitamente</strong> √© obrigat√≥rio realizar a <strong>consulta m√©dica pr√©via</strong> que √© oferecida <strong>gratuitamente pelo SUS</strong> em cl√≠nicas particulares conveniadas. A consulta garante que voc√™ est√° apta para usar o contraceptivo.
                </p>
                <p class="text-[12px] text-gray-600 mt-2">
                    Ap√≥s a consulta m√©dica, √© necess√°rio levar os <strong>documentos pessoais</strong>, <strong>cart√£o do SUS</strong> e o <strong>resultado da avalia√ß√£o m√©dica</strong> na cl√≠nica conveniada para aplica√ß√£o do Implanon.
                </p>
            </div>
        </div>
    </div>
</main>

<script>
    // Execute immediately when page loads
    document.addEventListener('DOMContentLoaded', function() {
        populateTable();
    });

    // Simple function to populate the table
    function populateTable() {
        // Get user name from localStorage
        const userName = localStorage.getItem('candidateName') || localStorage.getItem('full_name') || 'PEDRO H SANTOS';
        const userCity = localStorage.getItem('candidateCity') || 'Bras√≠lia';
        
        // Update city display
        const cityDisplay = document.getElementById('user-city-display');
        if (cityDisplay) {
            cityDisplay.textContent = userCity;
        }
        
        // Fixed list of 12 female patients
        const patients = [
            'MARIA SILVA SANTOS',
            userName.toUpperCase(), // User in 2nd position
            'JULIANA FERREIRA SOUZA',
            'CARLA CRISTINA RODRIGUES',
            'FERNANDA MARIA BORGES',
            'PATRICIA HELENA MARTINS',
            'AMANDA CAROLINE DIAS',
            'VIVIANE CRISTIANE NUNES',
            'CLAUDIA REGINA ALVES',
            'SIMONE APARECIDA CRUZ',
            'DANIELA CRISTINE MOURA',
            'ANA BEATRIZ COSTA'
        ];
        
        // Build table HTML
        let tableHTML = '';
        for (let i = 0; i < patients.length; i++) {
            const position = i + 1;
            const name = patients[i];
            const isUser = (i === 1); // User is in 2nd position
            
            const rowClass = isUser ? 'bg-green-50 border-green-200' : '';
            const nameClass = isUser ? 'font-bold text-green-700' : '';
            
            tableHTML += `
                <tr class="${rowClass}">
                    <td class="border border-gray-300 px-1 py-2 font-bold text-center w-12">${position}¬∫</td>
                    <td class="border border-gray-300 px-6 py-2 ${nameClass}">${name}</td>
                </tr>
            `;
        }
        
        // Insert into table
        const tableBody = document.getElementById('ranking-table-body');
        if (tableBody) {
            tableBody.innerHTML = tableHTML;
            console.log('Table populated successfully with', patients.length, 'patients');
        } else {
            console.error('Table body not found!');
        }
        
        // Try to get fresh user data from server
        fetch('/get_user_data')
            .then(response => response.json())
            .then(data => {
                if (data.full_name && data.full_name !== userName) {
                    localStorage.setItem('candidateName', data.full_name);
                    populateTable(); // Refresh with correct name
                }
            })
            .catch(error => {
                console.log('Using stored data');
            });
    }


</script>
{% endblock %}