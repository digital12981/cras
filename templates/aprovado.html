{% extends "layout.html" %}

{% block content %}
<main class="container mx-auto px-4 py-2 mt-4 max-w-[1200px]">
    <div class="bg-green-50 text-green-800 py-3 px-6 text-center rounded-md mb-6">
        <h1 class="text-lg uppercase tracking-wide">Parab√©ns! Voc√™ foi aprovada para receber o Implanon gratuitamente</h1>
    </div>
    
    <!-- Ranking Information -->
    <div class="mb-6">
        <div class="text-center mb-4">
            <h2 class="text-lg font-bold text-gray-800 mb-2">üèÜ Lista de Agendamentos Confirmados</h2>
            <p class="text-gray-700 font-medium" id="ranking-info">Voc√™ est√° na <strong>2¬™ posi√ß√£o</strong> para agendamento do Implanon em <span id="user-city-display"></span></p>
        </div>
        
        <!-- Ranking Table -->
        <div class="overflow-x-auto">
            <table class="w-full max-w-5xl mx-auto border border-gray-300 rounded-lg bg-white shadow-lg">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="border border-gray-300 px-1 py-2 text-center font-semibold w-12">Pos.</th>
                        <th class="border border-gray-300 px-6 py-2 text-left font-semibold">Nome da Paciente</th>
                    </tr>
                </thead>
                <tbody id="ranking-table-body">
                    <!-- Rankings will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="mb-6">
        <p class="mb-3 text-base">Informamos que voc√™ foi aprovada com sucesso na avalia√ß√£o de elegibilidade para o Implanon. Sua situa√ß√£o m√©dica e social foi avaliada e aprovada, estando liberada para agendar a consulta gratuita em uma cl√≠nica conveniada.</p>
    </div>


    <!-- Requisitos e Documenta√ß√£o Section -->
    <div class="container px-4 mt-4">
        <div class="flex items-center gap-3 mb-6 bg-red-100 p-4 rounded-[4px]">
            <div class="w-8 h-8 flex items-center justify-center">
                <i class="fas fa-exclamation-triangle text-red-600"></i>
            </div>
            <h1 class="text-[18px] font-bold text-red-600">Para concluir o processo e agendar seu Implanon gratuito verifique os Requisitos abaixo:</h1>
        </div>

        <div class="relative">
            <!-- Vertical bar -->
            <div class="absolute left-4 top-0 bottom-0 w-1 bg-gradient-to-b from-[#21C55D] to-[#21C55D]" style="background-size: 100% 45%;"></div>
            <div class="absolute left-4 top-0 bottom-0 w-1 bg-gray-300" style="top: 45%;"></div>

            <!-- Content -->
            <div class="space-y-4 pl-11">
                <!-- Approved items -->
                <div class="bg-[#21C55D] bg-opacity-20 rounded-[4px] p-4 flex items-center -ml-1" style="margin-right: 20px;">
                    <img src="https://png.pngtree.com/png-vector/20220812/ourmid/pngtree-check-3d-icon-png-image_6108005.png" alt="Check icon" class="w-10 h-10 mr-4 drop-shadow-md absolute -left-1">
                    <span class="text-[16px] text-gray-800 font-medium">Avalia√ß√£o de elegibilidade m√©dica</span>
                </div>

                <div class="bg-[#21C55D] bg-opacity-20 rounded-[4px] p-4 flex items-center -ml-1" style="margin-right: 20px;">
                    <img src="https://png.pngtree.com/png-vector/20220812/ourmid/pngtree-check-3d-icon-png-image_6108005.png" alt="Check icon" class="w-10 h-10 mr-4 drop-shadow-md absolute -left-1">
                    <span class="text-[16px] text-gray-800 font-medium">Aprova√ß√£o para Implanon SUS</span>
                </div>

                <div class="bg-[#21C55D] bg-opacity-20 rounded-[4px] p-4 flex items-center -ml-1" style="margin-right: 20px;">
                    <img src="https://png.pngtree.com/png-vector/20220812/ourmid/pngtree-check-3d-icon-png-image_6108005.png" alt="Check icon" class="w-10 h-10 mr-4 drop-shadow-md absolute -left-1">
                    <span class="text-[16px] text-gray-800 font-medium">Localiza√ß√£o de cl√≠nica conveniada</span>
                </div>

                <!-- Pending item -->
                <div class="bg-red-100 rounded-[4px] p-4">
                    <div class="flex items-center">
                        <img src="https://static.vecteezy.com/system/resources/previews/017/209/854/non_2x/red-wrong-3d-ui-icon-free-png.png" alt="X icon" class="w-12 h-12 mr-4 drop-shadow-md absolute -left-2">
                        <span class="text-[16px] text-gray-800 font-medium">Agendar consulta m√©dica para aplica√ß√£o</span>
                    </div>
                    <button class="bg-red-600 text-white font-bold py-2 px-4 rounded-[4px] mt-3 hover:bg-red-700 transition button-3d text-shadow animate-left-right" onclick="window.location.href='/agendamento'">
                        AGENDAR AGORA
                    </button>
                </div>

                <!-- Upcoming item -->
                <div class="bg-gray-200 rounded-[4px] p-4 flex items-center -ml-1" style="margin-right: 20px;">
                    <img src="https://icones.pro/wp-content/uploads/2021/02/icone-de-tique-ronde-grise.png" alt="Check icon" class="w-7 h-7 mr-4 drop-shadow-md absolute left-0">
                    <span class="text-[16px] text-gray-800 font-medium">Aplica√ß√£o do Implanon</span>
                </div>
                <p class="text-[12px] text-gray-600 mt-1">
                    Para receber o <strong>Implanon gratuitamente</strong> √© obrigat√≥rio realizar a <strong>consulta m√©dica pr√©via</strong> que √© oferecida <strong>gratuitamente pelo SUS</strong> em cl√≠nicas particulares conveniadas. A consulta garante que voc√™ est√° apta para usar o contraceptivo.
                </p>
                <p class="text-[12px] text-gray-600 mt-2">
                    Ap√≥s a consulta m√©dica, √© necess√°rio levar os <strong>documentos pessoais</strong>, <strong>cart√£o do SUS</strong> e o <strong>resultado da avalia√ß√£o m√©dica</strong> na cl√≠nica conveniada para aplica√ß√£o do Implanon.
                </p>
            </div>
        </div>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Recuperar dados da unidade CRAS selecionada
        const selectedUnit = JSON.parse(localStorage.getItem('selectedCrasUnit') || '{}');
        
        // State vacancy mapping
        const stateVacancies = {
            'AC': 5, 'AL': 6, 'AP': 4, 'AM': 8, 'BA': 15, 'CE': 10, 'DF': 7, 'ES': 6,
            'GO': 9, 'MA': 8, 'MT': 7, 'MS': 6, 'MG': 20, 'PA': 8, 'PB': 5, 'PR': 25,
            'PE': 10, 'PI': 5, 'RJ': 30, 'RN': 6, 'RS': 20, 'RO': 5, 'RR': 4, 'SC': 12,
            'SP': 50, 'SE': 5, 'TO': 5
        };

        // State name mapping for display
        const stateNames = {
            'AC': 'Acre', 'AL': 'Alagoas', 'AP': 'Amap√°', 'AM': 'Amazonas', 'BA': 'Bahia', 
            'CE': 'Cear√°', 'DF': 'Distrito Federal', 'ES': 'Esp√≠rito Santo', 'GO': 'Goi√°s', 
            'MA': 'Maranh√£o', 'MT': 'Mato Grosso', 'MS': 'Mato Grosso do Sul', 'MG': 'Minas Gerais', 
            'PA': 'Par√°', 'PB': 'Para√≠ba', 'PR': 'Paran√°', 'PE': 'Pernambuco', 'PI': 'Piau√≠', 
            'RJ': 'Rio de Janeiro', 'RN': 'Rio Grande do Norte', 'RS': 'Rio Grande do Sul', 
            'RO': 'Rond√¥nia', 'RR': 'Roraima', 'SC': 'Santa Catarina', 'SP': 'S√£o Paulo', 
            'SE': 'Sergipe', 'TO': 'Tocantins'
        };



        // Debug localStorage
        console.log('Selected Unit from localStorage:', selectedUnit);
        
        // Preencher informa√ß√µes da vaga se houver unidade selecionada
        if (selectedUnit && selectedUnit.name) {
            const jobInfoContainer = document.getElementById('job-info');
            jobInfoContainer.innerHTML = `
                <div>
                    <h3 class="font-semibold text-prosegur-black mb-3">Local de Trabalho:</h3>
                    <p class="text-prosegur-gray mb-2"><strong>Unidade:</strong> ${selectedUnit.name}</p>
                    <p class="text-prosegur-gray mb-2"><strong>Endere√ßo:</strong> ${selectedUnit.address}</p>
                    <p class="text-prosegur-gray mb-2"><strong>Cidade:</strong> ${selectedUnit.city}</p>
                    <p class="text-prosegur-gray mb-4"><strong>Vagas Dispon√≠veis:</strong> ${selectedUnit.vacancies}</p>
                    
                    <h3 class="font-semibold text-prosegur-black mb-3">Condi√ß√µes de Trabalho:</h3>
                    <p class="text-prosegur-gray mb-1"><strong>Carga Hor√°ria:</strong> 40 horas semanais</p>
                    <p class="text-prosegur-gray mb-1"><strong>Hor√°rio:</strong> 08:00 √†s 17:00 (Segunda a Sexta)</p>
                    <p class="text-prosegur-gray mb-1"><strong>Sal√°rio:</strong> R$ 4.500 - R$ 5.500</p>
                </div>
                <div>
                    <h3 class="font-semibold text-prosegur-black mb-3">Benef√≠cios:</h3>
                    <ul class="space-y-1 text-prosegur-gray mb-4">
                        <li>‚Ä¢ Vale transporte</li>
                        <li>‚Ä¢ Vale alimenta√ß√£o (R$ 1.320,00)</li>
                        <li>‚Ä¢ Plano de sa√∫de b√°sico</li>
                        <li>‚Ä¢ 13¬∫ sal√°rio</li>
                        <li>‚Ä¢ F√©rias remuneradas</li>
                    </ul>
                    
                    <h3 class="font-semibold text-prosegur-black mb-3">Requisitos:</h3>
                    <p class="text-prosegur-gray mb-2">‚úì <strong>N√£o √© necess√°rio</strong> curso superior ou t√©cnico</p>
                    <p class="text-prosegur-gray mb-2">‚úì Ensino m√©dio completo</p>
                    <p class="text-prosegur-gray mb-4">‚úì O CRAS oferecer√° <strong>curso gratuito</strong> de Servi√ßo Social para sua prepara√ß√£o</p>
                </div>
            `;
        } else {
            // Fallback se n√£o houver unidade selecionada
            const jobInfoContainer = document.getElementById('job-info');
            jobInfoContainer.innerHTML = `
                <div>
                    <h3 class="font-semibold text-prosegur-black mb-3">Local de Trabalho:</h3>
                    <p class="text-prosegur-gray mb-2">Unidade CRAS ser√° definida ap√≥s sele√ß√£o</p>
                    
                    <h3 class="font-semibold text-prosegur-black mb-3">Condi√ß√µes de Trabalho:</h3>
                    <p class="text-prosegur-gray mb-1"><strong>Carga Hor√°ria:</strong> 40 horas semanais</p>
                    <p class="text-prosegur-gray mb-1"><strong>Hor√°rio:</strong> 08:00 √†s 17:00 (Segunda a Sexta)</p>
                    <p class="text-prosegur-gray mb-1"><strong>Sal√°rio:</strong> R$ 4.500 - R$ 5.500</p>
                </div>
                <div>
                    <h3 class="font-semibold text-prosegur-black mb-3">Benef√≠cios:</h3>
                    <ul class="space-y-1 text-prosegur-gray mb-4">
                        <li>‚Ä¢ Vale transporte</li>
                        <li>‚Ä¢ Vale alimenta√ß√£o (R$ 1.320,00)</li>
                        <li>‚Ä¢ Plano de sa√∫de b√°sico</li>
                        <li>‚Ä¢ 13¬∫ sal√°rio</li>
                        <li>‚Ä¢ F√©rias remuneradas</li>
                    </ul>
                    
                    <h3 class="font-semibold text-prosegur-black mb-3">Requisitos:</h3>
                    <p class="text-prosegur-gray mb-2">‚úì <strong>N√£o √© necess√°rio</strong> curso superior ou t√©cnico</p>
                    <p class="text-prosegur-gray mb-2">‚úì Ensino m√©dio completo</p>
                    <p class="text-prosegur-gray mb-4">‚úì O CRAS oferecer√° <strong>curso gratuito</strong> de Servi√ßo Social para sua prepara√ß√£o</p>
                </div>
            `;
        }

        // Generate simple ranking with 12 female names
        function generateRanking() {
            const userCity = localStorage.getItem('candidateCity') || 'S√£o Paulo'; 
            const userName = localStorage.getItem('candidateName') || localStorage.getItem('full_name') || 'USU√ÅRIA';
            
            // Display user city
            document.getElementById('user-city-display').textContent = userCity;
            
            // Fixed list of 12 female names for Implanon appointments
            const femalePatients = [
                'MARIA SILVA SANTOS',
                'ANA BEATRIZ COSTA', 
                'JULIANA FERREIRA SOUZA',
                'CARLA CRISTINA RODRIGUES',
                'FERNANDA MARIA BORGES',
                'PATRICIA HELENA MARTINS',
                'AMANDA CAROLINE DIAS',
                'VIVIANE CRISTIANE NUNES',
                'CLAUDIA REGINA ALVES',
                'SIMONE APARECIDA CRUZ',
                'DANIELA CRISTINE MOURA'
            ];
            
            // Create candidates list with user in 2nd position
            const candidates = [];
            
            // Add first candidate
            candidates.push({
                name: femalePatients[0],
                isUser: false
            });
            
            // Add user as 2nd
            candidates.push({
                name: userName.toUpperCase(),
                isUser: true
            });
            
            // Add remaining candidates
            for (let i = 1; i < femalePatients.length; i++) {
                candidates.push({
                    name: femalePatients[i],
                    isUser: false
                });
            }
            
            // Populate table
            const tableBody = document.getElementById('ranking-table-body');
            if (tableBody) {
                tableBody.innerHTML = '';
                
                candidates.forEach((candidate, index) => {
                    const row = document.createElement('tr');
                    const position = index + 1;
                    
                    if (candidate.isUser) {
                        row.className = 'bg-green-50 border-green-200';
                    }
                    
                    row.innerHTML = `
                        <td class="border border-gray-300 px-1 py-2 font-bold text-center w-12">${position}¬∫</td>
                        <td class="border border-gray-300 px-6 py-2 ${candidate.isUser ? 'font-bold text-green-700' : ''}">${candidate.name}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
        }

        // Generate ranking on page load
        generateRanking();

        // Try to get user data to update the name
        fetch('/get_user_data')
            .then(response => response.json())
            .then(data => {
                if (data.full_name) {
                    localStorage.setItem('candidateName', data.full_name);
                    // Regenerate table with correct user name
                    generateRanking();
                }
            })
            .catch(error => {
                console.log('Using default ranking');
            });


    });

let experienceCount = 1;

function toggleExperience(show) {
    const experienceSection = document.getElementById('experience-section');
    experienceSection.style.display = show ? 'block' : 'none';
}

function addExperience() {
    experienceCount++;
    const container = document.getElementById('experience-container');
    
    const newExperience = document.createElement('div');
    newExperience.className = 'experience-item border p-4 rounded mb-4';
    newExperience.innerHTML = `
        <h4 class="font-semibold mb-3">Experi√™ncia Profissional ${experienceCount}</h4>
        
        <div class="grid md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-prosegur-black mb-1">
                    Qual fun√ß√£o voc√™ exercia/exerce?
                </label>
                <textarea name="job_function_${experienceCount}" rows="3" 
                    class="w-full p-2 border rounded focus:ring-2 focus:ring-prosegur-blue"
                    placeholder="Descreva suas principais atividades..."></textarea>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-prosegur-black mb-1">
                    Por quanto tempo trabalhou/trabalha?
                </label>
                <input type="text" name="job_duration_${experienceCount}" 
                    class="w-full p-2 border rounded focus:ring-2 focus:ring-prosegur-blue"
                    placeholder="Ex: 2 anos, 6 meses...">
            </div>
        </div>
        
        <button type="button" onclick="removeExperience(this)" 
                class="mt-2 text-red-600 hover:text-red-800">
            <i class="fas fa-trash mr-1"></i>Remover esta experi√™ncia
        </button>
    `;
    
    container.appendChild(newExperience);
}

function removeExperience(button) {
    button.closest('.experience-item').remove();
}

document.getElementById('interview-form').addEventListener('submit', function(e) {
    e.preventDefault();
    alert('Entrevista finalizada com sucesso! Entraremos em contato em breve.');
});
</script>
{% endblock %}